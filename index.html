
<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Schedule - Basic CMS</title>
  	<link rel="stylesheet" type="text/css" href="/assets/css/jquery.fancybox.css?v=2.1.2" media="screen" />

	<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<!--<script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>-->
	<script type="text/javascript" src="/assets/js/jquery.fancybox.pack.js?v=2.1.3"></script>
	<script src="/scheduler/assets/js/knockout.js"></script>
	<style type="text/css">
	</style>
</head>
<body>
	<div class="container">
		<section class="tickets">
			<h1>Tickets</h1>
			<ul data-bind="foreach: tickets">
				<li class="ticket" data-bind="css: 'ticket-' + id, text: summary"></li>
			</ul>
		</section>
		<div class="users" data-bind="foreach: users">
			<section>
				<h1 data-bind="text: name"></h1>
				<div class="days" data-bind="foreach: $root.visibleDays">
					<div class="day" data-bind="css: date.getDate()">
						<strong data-bind="text: date.toDateString()"></strong>
						<!-- ko foreach: [9, 13]-->
						<ul class="tasks am" data-bind="foreach: $parent.tasks($parents[1], $data)">
							<li class="task" data-bind="text: ticket.summary, style: {fontSize: height()}, css: 'task-' + id"></li>
						</ul>
						<!-- /ko -->
					</div>
				</div>
			</section>
		</div>
	</div>
	<script>
	function Task(data)
	{
		var self = this;
		this.id = data.id || 0;
		this.ticket = data.ticket;
		this.estimatedTime = ko.observable(data.estimatedTime || 1);
		this.date = data.date || new Date();
		this.height = function() {
			return (self.estimatedTime() * 10) + 'px';
		}
	}
	function Ticket(summary)
	{
		this.id = 0;
		this.summary = summary;
	}
	function User(name, tasks)
	{
		this.name = name;
		this.tasks = ko.observableArray(tasks);
	}

	function Day(date)
	{
		var self = this;
		this.date = date;
		this.isSameDay = function(date) {
			return date.toISOString().substr(0, 10) == self.date.toISOString().substr(0, 10);
		}
		this.tasks = function(user, hour) {
			return ko.utils.arrayFilter(user.tasks(), function(task) {
				return self.isSameDay(task.date) && (!hour || task.date.getHours() == hour)
			});
		};
	}
	function Scheduler()
	{
		var difficultTicket = new Ticket('A really difficult ticket');
		var impossibleTicket = new Ticket('Impossible ticket');
		var coolTicket = new Ticket('A cool ticket');
		var bugFix = new Ticket('Bug fix on the main site');
		var buildHomepage = new Ticket('Building homepage for new project');
		var afternoon = new Date;
		var morning = new Date;
		afternoon.setHours(13);
		morning.setHours(9);
		this.visibleDays = ko.observableArray([
			new Day(new Date(2013, 5, 26, 9)),
			new Day(new Date)
		]);
		this.tickets = ko.observableArray([
			difficultTicket, coolTicket, bugFix, buildHomepage, impossibleTicket
		]);
		this.users = ko.observableArray([
			new User('Sam', [
				new Task({
					ticket: coolTicket,
					date: morning
				}),
				new Task({
					ticket: difficultTicket,
					estimatedTime: 3,
					date: afternoon
				}),
				new Task({
					ticket: impossibleTicket,
					estimatedTime: 4,
					date: new Date(2013, 5, 26, 9)
				})
			]),
			new User('Mike', [
				new Task({
					ticket: difficultTicket,
					estimatedTime: 2,
					date: morning
				})]),
			new User('Dave', [
				new Task({
					ticket: bugFix,
					date: afternoon
				})
			]),
			new User('Dan', [
				new Task({
					ticket: difficultTicket,
					date: afternoon,
					estimatedTime: 4
				})
			])
		]);
	}
	ko.applyBindings(new Scheduler());
	</script>
</body>
</html>
